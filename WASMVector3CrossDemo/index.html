<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WASM Vector3Cross Demo</title>
</head>

<body>
  <h1>WASM Vector3Cross Demo</h1>
  <script type="module">
    (async () => {
      try {
        // Load WASM binary
        // https://developer.mozilla.org/en-US/docs/WebAssembly/Reference/JavaScript_interface/Instance
        const importObject = {};
        const { instance } = await WebAssembly.instantiateStreaming(
          fetch("Demo.wasm"),
          importObject
        );
        console.log("WASM binary loaded.");

        // Access the WASM binary instance's memory as an ArrayBuffer
        // https://developer.mozilla.org/en-US/docs/WebAssembly/Reference/JavaScript_interface/Memory/buffer
        const memoryBuffer = instance.exports.memory.buffer;
        const float32 = new Float32Array(memoryBuffer);

        // Note:
        //  In WASM, pointers are represented as byte offsets:
        //    V1 at indices 0..2 (byte offset 0)
        //    V2 at indices 3..5 (byte offset 12)
        //    Destination at indices 6..8 (byte offset 24)
        //
        // See:
        //  https://www.w3.org/TR/wasm-core-2/#memory

        // Set V1 = [1, 0, 0]
        float32[0] = 1.0;
        float32[1] = 0.0;
        float32[2] = 0.0;

        // Set V2 = [0, 1, 0]
        float32[3] = 0.0;
        float32[4] = 1.0;
        float32[5] = 0.0;

        // Destination = [0, 0, 0]
        float32[6] = 0.0;
        float32[7] = 0.0;
        float32[8] = 0.0;

        // Call Vector3Cross
        instance.exports.Vector3Cross(24, 0, 12);

        // Show result
        const result = [float32[6], float32[7], float32[8]];
        console.log(`Vector3Cross result: [${result.join(", ")}]`);
      } catch (error) {
        console.error("Error loading WASM binary:", error);
      }
    })();
  </script>
</body>

</html>